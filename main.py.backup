cat > main.py << 'EOF'
from fastapi import FastAPI, Depends, HTTPException, status
from fastapi.middleware.cors import CORSMiddleware
from sqlalchemy.orm import Session
from database import get_db
from crud import (
    create_student, get_students, get_student_by_id, 
    update_student, delete_student, search_students
)
from schemas import StudentCreate, StudentUpdate, StudentResponse
from typing import List, Optional

app = FastAPI(title="Student Management API", version="1.0.0")

# CORS settings for frontend
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # For development, restrict in production
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Root endpoint
@app.get("/")
def root():
    return {"message": "Student Management API", "status": "running"}

# Create student
@app.post("/students/", response_model=StudentResponse, status_code=status.HTTP_201_CREATED)
def create_student_endpoint(student: StudentCreate, db: Session = Depends(get_db)):
    return create_student(db, student.dict())

# Get all students
@app.get("/students/", response_model=List[StudentResponse])
def read_students(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):
    students = get_students(db, skip=skip, limit=limit)
    return students

# Get single student
@app.get("/students/{student_id}", response_model=StudentResponse)
def read_student(student_id: int, db: Session = Depends(get_db)):
    db_student = get_student_by_id(db, student_id)
    if db_student is None:
        raise HTTPException(status_code=404, detail="Student not found")
    return db_student

# Update student
@app.put("/students/{student_id}", response_model=StudentResponse)
def update_student_endpoint(
    student_id: int, 
    student: StudentUpdate, 
    db: Session = Depends(get_db)
):
    db_student = update_student(db, student_id, student.dict(exclude_unset=True))
    if db_student is None:
        raise HTTPException(status_code=404, detail="Student not found")
    return db_student

# Delete student
@app.delete("/students/{student_id}")
def delete_student_endpoint(student_id: int, db: Session = Depends(get_db)):
    success = delete_student(db, student_id)
    if not success:
        raise HTTPException(status_code=404, detail="Student not found")
    return {"message": "Student deleted successfully"}

# Search students
@app.get("/students/search/", response_model=List[StudentResponse])
def search_students_endpoint(
    name: Optional[str] = None, 
    course: Optional[str] = None,
    db: Session = Depends(get_db)
):
    return search_students(db, name=name, course=course)

# Health check
@app.get("/health")
def health_check():
    return {"status": "healthy"}
EOF
